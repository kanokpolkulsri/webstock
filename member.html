<!DOCTYPE html>
<?php
    $has_page = true;
    include 'check_connection.php';
?>
<html>
<head>
	<title></title>
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
</head>
<body>


	<!-- ตรงนี้เพิ่มส่วนของปุ่มกด กลับไปหน้าหลักกับออกจากระบบ -->
	<div class="btn-member-cateAndLogout">
		<a href=" ............ "><button class="button-back-cate">หน้าหลัก</button></a>
		<a href="./logout.php"><button class="button-user">ออกจากระบบ</button></a>	
	</div>



	<p class="header-member">USER Management</p>
	<div class="mode-member">
		<div class="button-mode-add">
			<button class="button-show-add-user">+</button> เพิ่มสมาชิก 
		</div>
		<div class="button-mode-show">
			<button class="button-show-member-data">+</button> ข้อมูลสมาชิก 
		</div>
		<div class="button-mode-delete">
			<button class="button-show-delete-user">+</button> ลบสมาชิก 
		</div>
	</div>

	<div class="add-user">
		<div class="add-user-input">
		<p> เพิ่มสมาชิก </p>
			<ul class="all-row-user">
				<li class="row-user">Username : <input type="input" name="locate" class="input-regis-username"></li>
				<li class="row-user">Password : <input type="input" name="locate" class="input-regis-pass1"></li>
				<li class="row-user">Confirm Password : <input type="input" name="locate" class="input-regis-pass2"></li>
				<li class="row-user">Name : <input type="input" name="locate" class="input-regis-name"></li>
				<li class="row-user">Phone : <input type="input" name="locate" class="input-regis-phone"></li>
				<li class="row-user">Company : <input type="input" name="locate" class="input-regis-company"></li>
				<li class="row-user">Position : <input type="input" name="locate" class="input-regis-position"></li>
				<li class="row-user"><button class="input-regis-select-admin"></button> admin</li>
				<li class="row-user"><button class="input-regis-select-user"></button> user</li>
				<br>
				<button class="button-add-user">เพิ่มสมาชิก</button>
			</ul>
		</div>
	</div>

	<div class="member-data">
		<div class="member-show-all-data">
		<p style="margin-left: 30px; margin-bottom: -20px">ข้อมูลสมาชิก</p>
			<div class="wrapper">
				<div class="table-user">
					<div class="row header blue">
						<div class="cell">Username</div>
						<div class="cell">Name</div>
						<div class="cell">Phone</div>
						<div class="cell">Company</div>
						<div class="cell">Position</div>
						<div class="cell">State</div>
		    		</div>
               <?php
                  $sql = 'SELECT * FROM users';
                  $result = $conn->query($sql);
                  if ($result->num_rows > 0) {
                  // output data of each row
                     while($row = $result->fetch_assoc()) {
                        echo '<div class="row">';
                        foreach($row as $key => $val) {
                           if($key == 'Password' || $key == 'LastUpdate') {
                              continue;
                           }
                           echo '<div class="cell">' . $val . '</div>';
                        }
                        echo '</div>';
                     }
                  } else {
                     echo 'no result.';
                  }
               ?>
				</div>
			</div>
		</div>
	</div>

	<div class="member-delete-user">
		<div class="del-user-input">
			<p style="margin-left: 30px"> ลบสมาชิก</p>
			<ul class="del-all-row-user">
				<li class="row-user">Username : <input type="input" name="locate" class="input-del-username"></li>
				<li class="row-user">Name : <input type="input" name="locate" class="input-del-name"></li>
				<li class="row-user">Company : <input type="input" name="locate" class="input-del-company"></li>
				<br>
				<button class="button-del-user">ลบสมาชิก</button>
			</ul>
		</div>
	</div>

	<script type="text/javascript">
	/*ส่วนตรงลบสมาชิก*/
	//ถ้าusernameอะไรมันเหมือนกันก็ลบ
	var delUserInput = $('.del-user-input');
	var buttonShowDeleteUser = $('.button-mode-delete');
	var checkShowDeleteUser = false;
	delUserInput.hide();
	buttonShowDeleteUser.click(function(){ //เปิดปิดเฉยๆ
		if(!checkShowDeleteUser){
			checkShowDeleteUser = true;
			memberShowAllData.hide();
			allRowUser.hide();
			delUserInput.show();
		}else{
			checkMemberShowAllData = false;
			checkButtonAddUser = false;
			checkShowDeleteUser = false;
			delUserInput.hide();
		}
	});
	var delUsername = $('.input-del-username');
	var delName = $('.input-del-name');
	var delCompany = $('.input-del-company');
	var buttonDeleteUser = $('.button-del-user');
	buttonDeleteUser.click(function(){
		//ถ้ากดปุ่มนี้ก็เอาค่า delUsername.val() , delName.val() , delCompany.val()
      $.post('./delete_user.php', {username: delUsername.val(), name: delName.val(), company: delCompany.val()}, function(data) {
         if(data !== 'success') {
            alert(data);
         } else {
            location.reload();
         }
      });
	});



	/*เอาข้อมูลมาประกาศไว้*/
		var memberShowAllData = $('.member-show-all-data');
		var buttonMemberShowAllData = $('.button-mode-show');
		var checkMemberShowAllData = false;
		memberShowAllData.hide();
		buttonMemberShowAllData.click(function(){
			if(!checkMemberShowAllData){
				checkMemberShowAllData = true;
				delUserInput.hide();
				allRowUser.hide();
				memberShowAllData.show();
			}else{
				checkMemberShowAllData = false;
				checkButtonAddUser = false;
				checkShowDeleteUser = false;
				memberShowAllData.hide();
			}
		});
		var useradd = $('.table-user');


	/*เพิ่มใหม่ตรง เพิ่มสมาชิก*/
		var buttonShowAddUser = $('.button-mode-add');
		var allRowUser = $('.add-user-input');
		var checkButtonAddUser = false;
		allRowUser.hide();
		buttonShowAddUser.click(function(){
			if(!checkButtonAddUser){
				// buttonShowAddUser.addClass('cate-btn-active');
				checkButtonAddUser = true;
				memberShowAllData.hide();
				delUserInput.hide();
				allRowUser.show();
			}else{
				// buttonShowAddUser.removeClass('cate-btn-active');
				checkMemberShowAllData = false;
				checkButtonAddUser = false;
				checkShowDeleteUser = false;
				allRowUser.hide();
			}
		});
		var regisUsername = $('.input-regis-username');
		var regisPass1 = $('.input-regis-pass1');
		var regisPass2 = $('.input-regis-pass2');
		var regisName = $('.input-regis-name');
		var regisPhone = $('.input-regis-phone');
		var regisCompany = $('.input-regis-company');
		var regisPosition = $('.input-regis-position');
		var buttonAddUser = $('.button-add-user');
		var buttonSelectAdmin = $('.input-regis-select-admin');
		var buttonSelectUser = $('.input-regis-select-user');
		var checkSelectAdmin = true;
		buttonSelectAdmin.click(function(){
			checkSelectAdmin = true;
			buttonSelectAdmin.addClass('member-btn-active');
			buttonSelectUser.removeClass('member-btn-active');
		});
		buttonSelectUser.click(function(){
			checkSelectAdmin = false;;
			buttonSelectUser.addClass('member-btn-active');
			buttonSelectAdmin.removeClass('member-btn-active');
		});
		buttonAddUser.click(function(){
			//ก็เอาค่าจาก regis.. ไปใส่ได้เลย
         if(regisPass1.val() !== regisPass2.val()) {
            alert('Passwords do not match.')
            return;
         }
         $.post('./add_user.php', {username: regisUsername.val(), password: regisPass1.val(), name: regisName.val(),
                  phone: regisPhone.val(), company: regisCompany.val(), position: regisPosition.val(), state: (checkSelectAdmin ? 'admin' : 'user')}, function(data) {
            if(data !== 'success') {
               alert(data);
            } else {
                location.reload();
            }
         });
		});
	</script>


</body>
</html>
